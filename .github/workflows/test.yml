name: ðŸ§ª Test datapacks
on: [push, pull_request, workflow_dispatch]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '21'
      - name: Setup environement variables
        run: |
          pip install -r scripts/requirements.txt
          python3 scripts/definitions.py
      - name: Download and prepare files
        run: |
          curl -o server.jar ${{ env.TEST_FABRIC_SERVER }}
          mkdir mods
          curl -o mods/fabric-api.jar ${{ env.TEST_FABRIC_API }}
          curl -o mods/packtest.jar ${{ env.TEST_PACKTEST }}
          mkdir -p world
          cp -r ${{ env.DATAPACKS_PATH }} world/datapacks
      - name: Run tests
        run: |
          java -Xmx2G -Dpacktest.auto -Dpacktest.auto.annotations -jar server.jar nogui
